(function(j){function I(a){function J(b,a){for(var c=b+"";c.length<a;)c="0"+c;return c}function x(a){var e=Array(n*i*3),h=b.list,d,f,g,m=n-1,j=i-1,o,p,k,l,a=c.time+=a*y;for(k=0;k<n;k++)for(l=0;l<i;l++){o=C*(k/n);p=D*(l/i);if(k!==0&&k!==m&&l!==0&&l!==j){d=h[k+l*i];d.amplitude=Math.min(t,Math.max(r,d.amplitude+E*d.dir));g=u+Math.min(s,Math.max(q,d.frequency+F*d.dir));if(d.dirSwitch>d.dirSwitchCount)d.dir=-d.dir,d.dirSwitch=0;d.dirSwitch+=b.dirSwitchDelta*d.dir;f=d.amplitude}else f=0,g=u;d=k+l*i;e[d]=
f+G*(Math.cos(o*g+a)+Math.sin(p*g+a))}return e}var a=a||{},e,c,b,g,m,o,n,i,C,D,y,G,u,p,v,t,r,E,s,q,F,f;c=this.waves={};c.time=0;m=a.wavesColor||776954;p=a.wavesAmbient||3445460;e=a.wavesSize||1E4;c.vertsW=n=a.wavesVertsW||100;c.vertsH=i=a.wavesVertsH||100;c.numHorizontal=C=a.wavesNumHorizontal||80;c.numVertical=D=a.wavesNumVertical||80;c.speed=y=a.wavesSpeed||0.001;c.amplitude=G=a.wavesAmplitude||50;c.frequency=u=a.wavesFrequency||0.5;c.timePerCycle=1E3*Math.PI*2*1E3*y;b=c.vv={};b.list=[];b.ampAbs=
a.vvAmpAbs||35;b.ampMin=r=-Math.min(c.amplitude*0.5,b.ampAbs);b.ampMax=t=Math.min(c.amplitude*0.5,b.ampAbs);b.ampDelta=E=(t-r)*0.01;b.freqAbs=u;b.freqMin=q=-b.freqAbs*0.05;b.freqMax=s=b.freqAbs*0.05;b.freqDelta=F=(s-q)*0.001;b.dirSwitchPause=c.timePerCycle*0.5;b.dirSwitchDelta=b.dirSwitchPause/60;g=new THREE.PlaneGeometry(e,e,n-1,i-1);g.dynamic=!0;H.apply_matrix(g,(new THREE.Matrix4).makeRotationX(-Math.PI/2));v=g.vertices.length;f=(s-q)*0.5;for(e=0;e<v;e++)b.list[e]={amplitude:Math.random()*(t-r)+
r,frequency:f*0.75+(Math.random()*(s-q)+q)*0.25,dir:1,dirSwitch:Math.round(Math.random()*b.dirSwitchPause*0.5+b.dirSwitchPause*0.5),dirSwitchCount:Math.round(Math.random()*b.dirSwitchPause*0.5+b.dirSwitchPause*0.5)},f=b.list[e].frequency;m=new THREE.MeshLambertMaterial({ambient:p,color:m,shading:THREE.SmoothShading,transparent:!0,opacity:a.wavesOpacity||0.9,side:THREE.DoubleSide});typeof a.wavesTexture==="string"?(o=new THREE.Texture,j.asset_require(a.wavesTexture,function(a){o.image=a;o.needsUpdate=
!0}),m.map=o):m.map=h.wavesTexture;p=c.timePerCycle/10;var z,A,w;for(e=0;e<10;e++){f=g.morphTargets[e]={};f.name="waves_"+J(e,4);f.vertices=[];v=x(p);f=f.vertices;for(w=0;w<n*i;w++)z=w,A=g.vertices[z],f.push(new THREE.Vector3(A.x,v[z],A.z))}a.geometry=g;a.material=m;B.Instance.call(this,a);this.options=$.extend(!0,this.options||{},h.options,a.options)}var K=j.shared=j.shared||{},h={},B,H;j.asset_register("js/kaiopua/env/Water.js",{data:h,requirements:["js/kaiopua/core/Model.js","js/kaiopua/utils/ObjectHelper.js",
K.pathToAssets+"water_512.png"],callbacksOnReqs:function(a,j,x){B=a;H=j;h.options={intersectable:!1};h.wavesTexture=new THREE.Texture(x);h.wavesTexture.needsUpdate=!0;h.Instance=I;h.Instance.prototype=new B.Instance;h.Instance.prototype.constructor=h.Instance},wait:!0})})(KAIOPUA);

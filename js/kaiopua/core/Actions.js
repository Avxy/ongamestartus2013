(function(i){function n(a){return typeof a==="string"?a.replace(/\s{2,}/g," ").split(" "):i.to_array(a)}function o(a,b){return b.options.priority-a.options.priority}function m(a){var b,a=a||{};this.options=$.extend(!0,{},p,a.options);this.id=q++;this.eventCallbacks=a.eventCallbacks||{};this.deactivateCallbacks=i.to_array(a.deactivateCallbacks);this.eventsActive=[];this.activeCheck=a.activeCheck||{};for(b in this.eventCallbacks)this.eventCallbacks.hasOwnProperty(b)&&(this.eventCallbacks[b]=i.to_array(this.eventCallbacks[b]))}
i.shared=i.shared||{};var e={},q=0,p={priority:0,blocking:!1,silencing:!1,type:"action_untyped"};e.Instance=function(){this.map={};this.actionNames=[];this.actionsByType={}};e.Instance.prototype.constructor=e.Instance;e.Instance.prototype.add=function(a){var b,d,c,g,f,j,h,e,k,l,a=i.to_array(a);for(b=0,d=a.length;b<d;b++){f=a[b];c=f.names;j=n(c);f.clean===!0&&this.remove(j);for(c=0,g=j.length;c<g;c++)h=j[c],e=this.map[h]=this.map[h]||[],k=new m(f),l=k.options.type,typeof this.actionsByType[l]==="undefined"&&
(this.actionsByType[l]=[]),i.array_cautious_add(this.actionsByType[l],k),e.push(k),e.sort(o),i.array_cautious_add(this.actionNames,h)}};e.Instance.prototype.remove=function(a){var b,d,c,g=n(a),f,j,h,e;for(a=0,b=g.length;a<b;a++)if(f=g[a],this.map.hasOwnProperty(f)){j=this.map[f];for(d=0,c=j.length;d<c;d++)h=j[d],h.deactivate(),e=h.options.type,i.array_cautious_remove(this.actionsByType[e],h),this.actionsByType[e].length===0&&delete this.actionsByType[e];delete this.map[f];i.array_cautious_remove(this.actionNames,
f)}};e.Instance.prototype.execute=function(a,b,d){var c,g,f,e;if(this.map.hasOwnProperty(a)){g=this.map[a];for(a=0,c=g.length;a<c;a++)if(f=g[a],e=f.execute(b,d),(f.options.silencing===!0||e===!0&&f.options.blocking===!0)&&f.active===!0)break}};e.Instance.prototype.is_active=function(a){var b,d,c,g,f;if(typeof a!=="undefined"){a=i.to_array(a);for(b=0,d=a.length;b<d;b++){c=a[b];if(this.map.hasOwnProperty(c)&&this.map[c].active)return!0;if(this.actionsByType.hasOwnProperty(c)){f=this.actionsByType[c];
for(c=0,g=f.length;c<g;c++)if(f[c].active)return!0}}}else for(b=0,d=this.actionNames.length;b<d;b++){a=this.map[this.actionNames[b]];for(c=0,g=a.length;c<g;c++)if(a[c].active)return!0}return!1};e.Instance.prototype.clear_active=function(){var a,b,d,c,g;for(a=0,b=this.actionNames.length;a<b;a++){g=this.map[this.actionNames[a]];for(d=0,c=g.length;d<c;d++)g[d].deactivate()}};i.asset_register("js/kaiopua/core/Actions.js",{data:e});m.prototype={execute:function(a,b){var d,c,g,f,e=this.eventCallbacks.hasOwnProperty(a),
h;if(e){b=b||{};h=this.is_deactivate_callback(a);g=this.eventCallbacks[a];for(d=0,c=g.length;d<c;d++)f=g[d],h!==!0&&(h=this.is_deactivate_callback(f)),f(b);b.event&&b.allowDefault!==!0&&b.event.preventDefault();h===!0?this.reset():i.array_cautious_add(this.eventsActive,a)}return e},deactivate:function(){var a,b,d=this.deactivateCallbacks,c;for(a=0,b=d.length;a<b;a++)c=d[a],typeof c==="function"?c():typeof c==="string"&&this.eventCallbacks.hasOwnProperty(c)&&this.execute(c);this.reset()},is_deactivate_callback:function(a){var b,
d,c=this.deactivateCallbacks;for(b=0,d=c.length;b<d;b++)if(a===c[b])return!0;return!1},reset:function(){this.eventsActive=[]}};Object.defineProperty(m.prototype,"active",{get:function(){return typeof this.activeCheck==="function"?this.activeCheck():this.eventsActive.length>0}})})(KAIOPUA);

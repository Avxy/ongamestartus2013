(function(f){function k(b){b=b||{};b.options=$.extend(!0,{},c.options,b.options);g.Instance.call(this,b);this.effects={speedDelta:(new THREE.Vector3(1,1,1)).multiplyScalar(this.options.effects.speedDelta)}}function l(b,d){var g=this,a=c.Instance.prototype.supr.affect.apply(this,arguments),j=this.options,f=j.pushback,h,e,d=d||{};h=d.velocity;if(typeof b.hurt==="function"&&a.cooldown!==!0&&(j=b.hurt(j.damage),h=h.collision,e=b.rigidBody,j===!0&&h&&typeof e!=="undefined")){a.cooldown=!0;typeof a.change!==
"undefined"&&(i.revert_change(e.velocityMovement,a.change),delete a.change);if(a.collision!==h)a.change=i.temporary_change(e.velocityMovement,this.effects);a.collision=h;a.pushbackNormal=a.collision.normal.clone();this.matrixWorld.rotateAxis(a.pushbackNormal);a.pushbackDelta=a.pushbackNormal.clone();e.velocityGravity.clear();e.velocityMovement.clear();e.velocityMovement.dampingPre.set(1,1,1);a.tweenFrom={speed:f.speedStart};a.tweenTo={speed:f.speedEnd};i.tween(a.tweenFrom,a.tweenTo,{duration:f.duration,
onUpdate:function(){a.pushbackDelta.copy(a.pushbackNormal).multiplyScalar(a.tweenFrom.speed);e.velocityMovement.forceDeltaExternal.addSelf(a.pushbackDelta)},onComplete:function(){a.cooldown=!1;g.unaffect(b)}})}return a}function m(b){var d=c.Instance.prototype.supr.unaffect.apply(this,arguments);typeof d!=="undefined"&&i.revert_change(b.rigidBody.velocityMovement,d.change);return d}f.shared=f.shared||{};var c={},g,i;f.asset_register("js/kaiopua/physics/ObstacleDamaging.js",{data:c,requirements:["js/kaiopua/physics/Obstacle.js",
"js/kaiopua/utils/ObjectHelper.js"],callbacksOnReqs:function(b,d){g=b;i=d;c.options={damage:1,pushback:{speedStart:10,speedEnd:0,duration:400},effects:{speedDelta:0}};c.Instance=k;c.Instance.prototype=new g.Instance;c.Instance.prototype.constructor=c.Instance;c.Instance.prototype.supr=g.Instance.prototype;c.Instance.prototype.affect=l;c.Instance.prototype.unaffect=m},wait:!0})})(KAIOPUA);

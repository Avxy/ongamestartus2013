(function(g){function h(a){var c,d,e,a=a||{};this.options=$.extend(!0,{},b.options,a.options);this.rigidBody=a.rigidBody;this.force=new THREE.Vector3;this.forceInternal=new THREE.Vector3;this.forceRotated=new THREE.Vector3;this.forceApplied=new THREE.Vector3;this.forceRecentMax=new THREE.Vector3;this.forceDelta=new THREE.Vector3;this.forceDeltaExternal=new THREE.Vector3;this.speedDelta=new THREE.Vector3;this.damping=new THREE.Vector3;this.dampingPre=new THREE.Vector3;this.offsets=[];this.offsetsRotated=
[];this.relativeTo=a.relativeTo;this.relativeToQ=new THREE.Quaternion;this.rotatedRelativeTo=[];this.up=i.cardinalAxes.up.clone();if((d=a.offsets)&&d.length>0)for(a=0,c=d.length;a<c;a++)e=d[a],e instanceof THREE.Vector3&&this.offsets.push(e.clone());else this.offsets.push(new THREE.Vector3);for(a=0,c=this.offsets.length;a<c;a++)this.offsetsRotated.push(this.offsets[a].clone());this.reset()}function j(){this.clear();this.damping.set(1,1,1).multiplyScalar(this.options.damping);this.dampingPre.set(1,
1,1).multiplyScalar(this.options.dampingPre);this.speedDelta.set(1,1,1).multiplyScalar(this.options.speedDelta);this.intersection=this.collision=this.sliding=!1}function k(){this.forceDelta.set(0,0,0);this.force.set(0,0,0);this.forceInternal.set(0,0,0);this.forceRotated.set(0,0,0);this.moving=!1}function l(a){var c,b,e=1;a instanceof THREE.Quaternion===!1&&(a=f.retrieve_relative_to(this.relativeTo,this.up));a instanceof THREE.Quaternion&&this.relativeToQ.copy(a);this.forceDelta.multiplySelf(this.speedDelta);
this.force.addSelf(this.forceDelta);this.forceDelta.copy(f.rotate_relative_to(this.forceDelta,this.relativeToQ));this.forceInternal.addSelf(this.forceDelta);a=this.options.forceLengthMax;a<Number.MAX_VALUE&&(f.clamp_length(this.force,a),f.clamp_length(this.forceInternal,a));this.force.multiplySelf(this.dampingPre);this.forceInternal.multiplySelf(this.dampingPre);this.forceRotated.add(this.forceInternal,this.forceDeltaExternal);if(this.rigidBody)a=this.rigidBody.object,a instanceof THREE.Object3D&&
(e=Math.max(a.scale.x,a.scale.y,a.scale.z));for(a=0,c=this.offsets.length;a<c;a++)b=this.offsetsRotated[a],b.copy(f.rotate_relative_to(this.offsets[a],this.relativeToQ)),e!==1&&b.multiplyScalar(e);this.forceDelta.set(0,0,0);this.forceDeltaExternal.set(0,0,0)}function m(){this.force.multiplySelf(this.damping);this.forceInternal.multiplySelf(this.damping)}function n(a){var b,d;if(a instanceof THREE.Quaternion||a instanceof THREE.Matrix4){a.multiplyVector3(this.forceRotated);for(b=0,d=this.offsetsRotated.length;b<
d;b++)a.multiplyVector3(this.offsetsRotated[b])}}var i=g.shared=g.shared||{},b={},f;g.asset_register("js/kaiopua/physics/Velocity.js",{data:b,requirements:["js/kaiopua/utils/VectorHelper.js"],callbacksOnReqs:function(a){f=a;b.options={damping:0.97,dampingPre:1,dampingDecay:0.95,speedDelta:1,collisionAngleThreshold:Math.PI*0.5,collisionAngleThresholdMax:Math.PI*0.5,forceLengthMax:Number.MAX_VALUE};b.Instance=h;b.Instance.prototype.constructor=b.Instance;b.Instance.prototype.reset=j;b.Instance.prototype.clear=
k;b.Instance.prototype.rotate=n;b.Instance.prototype.update=l;b.Instance.prototype.damp=m},wait:!0})})(KAIOPUA);
